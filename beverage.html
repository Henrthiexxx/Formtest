<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Selecionar Bebidas</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; background: #fffbe6; }
    h2 { color: #c0392b; }
    .btn-option {
      display: block;
      margin: 0.5rem 0;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
    }
    button {
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 8px;
      background: #27ae60;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>ðŸ¥¤ Selecione suas bebidas</h2>
  <div id="bebidas"></div>

  <button onclick="salvarBebidas()">ðŸ’¾ Salvar e voltar</button>

<script>
  const API_KEY = "AIzaSyDBdfuNCfQcxINcNmAt70gWJAAVNXEBua4";
  const SHEET_ID = "1mV3hHTS9U8Z9zXFJ9UK0cMJ3kpZPGHe4VIldDv6nOdA";
  const ABA = "Bebidas";

async function carregarBebidas() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${ABA}!A2:E?key=${API_KEY}`;
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Erro na requisiÃ§Ã£o: ${res.status}`);
    const data = await res.json();
    const linhas = data.values || [];

    console.log("Linhas carregadas:", linhas); // debug

    const container = document.getElementById("bebidas");
    container.innerHTML = ''; // limpar

    linhas.forEach((linha, i) => {
      const status = (linha[4] || '').toLowerCase();
      if (status !== 'ativo') return;

      const nome = linha[0] || `Sem nome (${i + 1})`;
      let precoTexto = linha[2] || "0";
      
      // Limpar preÃ§o (remover "R$", espaÃ§os, e lidar com vÃ­rgulas/pontos)
      precoTexto = precoTexto.replace(/[^\d,.]/g, '').replace(',', '.');
      const preco = parseFloat(precoTexto) || 0;

      const id = `bebida_${i}`;
      const label = document.createElement("label");
      label.className = "btn-option";
      label.innerHTML = `
        <input type="checkbox" id="${id}" data-nome="${nome}" data-preco="${preco}" />
        ${nome} - R$ ${preco.toFixed(2).replace('.', ',')}
      `;
      container.appendChild(label);
    });
  } catch (error) {
    console.error("Erro ao carregar bebidas:", error);
    document.getElementById("bebidas").innerHTML = "<p>Erro ao carregar bebidas. Verifique a planilha ou a conexÃ£o.</p>";
  }
}

  function salvarBebidas() {
    const selecionadas = [];
    document.querySelectorAll("#bebidas input:checked").forEach(input => {
      selecionadas.push({
        nome: input.dataset.nome,
        preco: parseFloat(input.dataset.preco),
        qtd: 1
      });
    });

    const carrinho = JSON.parse(localStorage.getItem("carrinhoGlobal")) || [];
    carrinho.push(...selecionadas);
    localStorage.setItem("carrinhoGlobal", JSON.stringify(carrinho));
    alert("Bebidas adicionadas ao carrinho!");
    window.location.href = "catalog.html";
  }

  carregarBebidas();
</script>

</body>
</html>
