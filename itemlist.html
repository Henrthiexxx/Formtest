<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Carrinho</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    #produtos div, #carrinho li { margin: 5px 0; }
    button { margin-left: 5px; padding: 5px 10px; }
    #carrinho { list-style: none; padding: 0; }
    #total { font-weight: bold; margin-top: 10px; }
    input[type="text"] { padding: 5px; width: 100%; max-width: 300px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>ðŸ›’ Produtos</h2>
  <input type="text" id="busca" placeholder="Buscar produto..." oninput="filtrarProdutos()">
  <div id="produtos">Carregando produtos...</div>

  <h2>ðŸ§¾ Carrinho</h2>
  <ul id="carrinho"></ul>
  <p id="total">Total: R$ 0,00</p>

  <script>
    const API_KEY = "AIzaSyDBdfuNCfQcxINcNmAt70gWJAAVNXEBua4";
    const SPREADSHEET_ID = "1mV3hHTS9U8Z9zXFJ9UK0cMJ3kpZPGHe4VIldDv6nOdA";
    const ABA = "Products";
    let dados = [], carrinho = [];

    // Buscar dados da planilha
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${ABA}!A2:C?key=${API_KEY}`)
      .then(r => r.json())
      .then(res => {
        dados = (res.values || []).map(l => [l[0], parseFloat(l[2] || 0)]);
        mostrarProdutos(dados);
      });

    function mostrarProdutos(lista) {
      const div = document.getElementById('produtos');
      div.innerHTML = '';
      lista.forEach(([nome, preco]) => {
        if (!nome || isNaN(preco)) return;
        const item = document.createElement('div');
        item.innerHTML = `${nome} - R$ ${preco.toFixed(2)} <button onclick="adicionarCarrinho('${nome}', ${preco})">Adicionar</button>`;
        div.appendChild(item);
      });
    }

    function adicionarCarrinho(nome, preco) {
      carrinho.push({ nome, preco });
      atualizarCarrinho();
    }

    function atualizarCarrinho() {
      const ul = document.getElementById('carrinho');
      ul.innerHTML = '';
      let total = 0;
      carrinho.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.nome} - R$ ${item.preco.toFixed(2)}`;
        ul.appendChild(li);
        total += item.preco;
      });
      document.getElementById('total').textContent = `Total: R$ ${total.toFixed(2)}`;
    }

    function filtrarProdutos() {
      const termo = document.getElementById('busca').value.toLowerCase();
      const filtrados = dados.filter(([nome]) => nome.toLowerCase().includes(termo));
      mostrarProdutos(filtrados);
    }
  </script>
</body>
</html>
