<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Carrinho</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    input, button { padding: 8px; font-size: 14px; }
    #sugestoes { background: #fff; border: 1px solid #ccc; max-width: 300px; }
    .sugestao { padding: 5px; cursor: pointer; }
    .sugestao:hover { background: #eee; }
    #detalheProduto { margin-top: 10px; }
    #carrinho li { margin: 5px 0; }
    #total { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>ðŸ›’ Buscar Produto</h2>
  <input type="text" id="busca" placeholder="Digite o nome do produto..." oninput="mostrarSugestoes()">
  <div id="sugestoes"></div>

  <div id="detalheProduto"></div>

  <h2>ðŸ§¾ Lista de Compras</h2>
  <ul id="carrinho"></ul>
  <p id="total">Total: R$ 0,00</p>
<div style="margin-top: 10px;">
  <button onclick="enviarLista()">ðŸ“¤ Enviar Lista</button>
  <button onclick="limparCarrinho()">ðŸ§¹ Limpar Carrinho</button>
</div>
  <script>
    const API_KEY = "AIzaSyDBdfuNCfQcxINcNmAt70gWJAAVNXEBua4";
    const SPREADSHEET_ID = "1mV3hHTS9U8Z9zXFJ9UK0cMJ3kpZPGHe4VIldDv6nOdA";
    const ABA = "Products";
    let produtos = [], carrinho = [];

    // Carregar produtos da planilha
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${ABA}!A2:C?key=${API_KEY}`)
      .then(r => r.json())
      .then(res => {
        produtos = (res.values || []).map(l => {
          const precoBruto = (l[2] || '').replace(/[^\d,.-]/g, '').replace(',', '.');
          const preco = parseFloat(precoBruto);
          return { nome: l[0], preco: isNaN(preco) ? 0 : preco };
        });
      });

    function mostrarSugestoes() {
      const termo = document.getElementById('busca').value.toLowerCase();
      const sugestoes = produtos.filter(p => p.nome.toLowerCase().includes(termo));
      const div = document.getElementById('sugestoes');
      div.innerHTML = '';
      sugestoes.forEach(p => {
        const el = document.createElement('div');
        el.className = 'sugestao';
        el.textContent = p.nome;
        el.onclick = () => selecionarProduto(p);
        div.appendChild(el);
      });
    }

    function selecionarProduto(produto) {
      document.getElementById('sugestoes').innerHTML = '';
      document.getElementById('busca').value = produto.nome;
      const div = document.getElementById('detalheProduto');
      div.innerHTML = `
        <p><strong>${produto.nome}</strong> - R$ ${produto.preco.toFixed(2)}</p>
        <button onclick="adicionarCarrinho('${produto.nome}', ${produto.preco})">Adicionar</button>
      `;
    }

    function adicionarCarrinho(nome, preco) {
      carrinho.push({ nome, preco });
      atualizarCarrinho();
    }

    function atualizarCarrinho() {
      const ul = document.getElementById('carrinho');
      ul.innerHTML = '';
      let total = 0;
      carrinho.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `${item.nome} - R$ ${item.preco.toFixed(2)} 
          <button onclick="removerItem(${index})">Remover</button>`;
        ul.appendChild(li);
        total += item.preco;
      });
      document.getElementById('total').textContent = `Total: R$ ${total.toFixed(2)}`;
    }

    function removerItem(i) {
      carrinho.splice(i, 1);
      atualizarCarrinho();
    }
    function limparCarrinho() {
  carrinho = [];
  atualizarCarrinho();
}
    function enviarLista() {
  if (carrinho.length === 0) {
    alert("Carrinho vazio!");
    return;
  }
  let texto = "OlÃ¡! Segue minha lista de compras:\n\n";
  carrinho.forEach(item => {
    texto += `â€¢ ${item.nome} - R$ ${item.preco.toFixed(2)}\n`;
  });
  const total = carrinho.reduce((s, i) => s + i.preco, 0);
  texto += `\nTotal: R$ ${total.toFixed(2)}`;
  
  const url = `https://wa.me/5566996455672?text=${encodeURIComponent(texto)}`;
  window.open(url, '_blank');
}
  </script>
</body>
</html>
